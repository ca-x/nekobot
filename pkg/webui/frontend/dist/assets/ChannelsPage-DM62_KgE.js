import{r as d,j as t,d as I,e as je,b as F,t as u,a as L}from"./index-BGArHTig.js";import{P as S,c as y,a as q,b as Ce,d as B,e as ye,f as we,u as Te,S as Ne,B as E,H as Ie}from"./scroll-area-DituK3c-.js";import{C as Fe,a as Se}from"./card-I9j3A_6K.js";import{u as z,c as Re,a as H,I as k}from"./Combination-BG_crsyY.js";import{S as Ee}from"./skeleton-CrrH39eg.js";import{u as Q}from"./useMutation-BcvfjVkU.js";import{D as De,a as Ae,b as _e,c as Pe,d as ke,e as Me}from"./dialog-DM_LmnDo.js";import{L as Oe}from"./label-4PTa_hnU.js";import{S as Ge}from"./switch-J8oJt6rn.js";var M="rovingFocusGroup.onEntryFocus",Le={bubbles:!1,cancelable:!0},R="RovingFocusGroup",[O,J,Ke]=Re(R),[Ue,W]=q(R,[Ke]),[$e,Ve]=Ue(R),Y=d.forwardRef((e,n)=>t.jsx(O.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(O.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(qe,{...e,ref:n})})}));Y.displayName=R;var qe=d.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:o,orientation:r,loop:g=!1,dir:f,currentTabStopId:i,defaultCurrentTabStopId:b,onCurrentTabStopIdChange:v,onEntryFocus:p,preventScrollOnEntryFocus:l=!1,...a}=e,s=d.useRef(null),c=Ce(n,s),x=B(f),[h,m]=H({prop:i,defaultProp:b??null,onChange:v,caller:R}),[w,A]=d.useState(!1),C=ye(p),T=J(o),_=d.useRef(!1),[pe,U]=d.useState(0);return d.useEffect(()=>{const j=s.current;if(j)return j.addEventListener(M,C),()=>j.removeEventListener(M,C)},[C]),t.jsx($e,{scope:o,orientation:r,dir:x,loop:g,currentTabStopId:h,onItemFocus:d.useCallback(j=>m(j),[m]),onItemShiftTab:d.useCallback(()=>A(!0),[]),onFocusableItemAdd:d.useCallback(()=>U(j=>j+1),[]),onFocusableItemRemove:d.useCallback(()=>U(j=>j-1),[]),children:t.jsx(S.div,{tabIndex:w||pe===0?-1:0,"data-orientation":r,...a,ref:c,style:{outline:"none",...e.style},onMouseDown:y(e.onMouseDown,()=>{_.current=!0}),onFocus:y(e.onFocus,j=>{const be=!_.current;if(j.target===j.currentTarget&&be&&!w){const $=new CustomEvent(M,Le);if(j.currentTarget.dispatchEvent($),!$.defaultPrevented){const P=T().filter(N=>N.focusable),xe=P.find(N=>N.active),he=P.find(N=>N.id===h),ve=[xe,he,...P].filter(Boolean).map(N=>N.ref.current);ee(ve,l)}}_.current=!1}),onBlur:y(e.onBlur,()=>A(!1))})})}),X="RovingFocusGroupItem",Z=d.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:o,focusable:r=!0,active:g=!1,tabStopId:f,children:i,...b}=e,v=z(),p=f||v,l=Ve(X,o),a=l.currentTabStopId===p,s=J(o),{onFocusableItemAdd:c,onFocusableItemRemove:x,currentTabStopId:h}=l;return d.useEffect(()=>{if(r)return c(),()=>x()},[r,c,x]),t.jsx(O.ItemSlot,{scope:o,id:p,focusable:r,active:g,children:t.jsx(S.span,{tabIndex:a?0:-1,"data-orientation":l.orientation,...b,ref:n,onMouseDown:y(e.onMouseDown,m=>{r?l.onItemFocus(p):m.preventDefault()}),onFocus:y(e.onFocus,()=>l.onItemFocus(p)),onKeyDown:y(e.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){l.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const w=He(m,l.orientation,l.dir);if(w!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let C=s().filter(T=>T.focusable).map(T=>T.ref.current);if(w==="last")C.reverse();else if(w==="prev"||w==="next"){w==="prev"&&C.reverse();const T=C.indexOf(m.currentTarget);C=l.loop?Qe(C,T+1):C.slice(T+1)}setTimeout(()=>ee(C))}}),children:typeof i=="function"?i({isCurrentTabStop:a,hasTabStop:h!=null}):i})})});Z.displayName=X;var Be={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ze(e,n){return n!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function He(e,n,o){const r=ze(e.key,o);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return Be[r]}function ee(e,n=!1){const o=document.activeElement;for(const r of e)if(r===o||(r.focus({preventScroll:n}),document.activeElement!==o))return}function Qe(e,n){return e.map((o,r)=>e[(n+r)%e.length])}var Je=Y,We=Z,D="Tabs",[Ye]=q(D,[W]),te=W(),[Xe,K]=Ye(D),ne=d.forwardRef((e,n)=>{const{__scopeTabs:o,value:r,onValueChange:g,defaultValue:f,orientation:i="horizontal",dir:b,activationMode:v="automatic",...p}=e,l=B(b),[a,s]=H({prop:r,onChange:g,defaultProp:f??"",caller:D});return t.jsx(Xe,{scope:o,baseId:z(),value:a,onValueChange:s,orientation:i,dir:l,activationMode:v,children:t.jsx(S.div,{dir:l,"data-orientation":i,...p,ref:n})})});ne.displayName=D;var se="TabsList",oe=d.forwardRef((e,n)=>{const{__scopeTabs:o,loop:r=!0,...g}=e,f=K(se,o),i=te(o);return t.jsx(Je,{asChild:!0,...i,orientation:f.orientation,dir:f.dir,loop:r,children:t.jsx(S.div,{role:"tablist","aria-orientation":f.orientation,...g,ref:n})})});oe.displayName=se;var ae="TabsTrigger",re=d.forwardRef((e,n)=>{const{__scopeTabs:o,value:r,disabled:g=!1,...f}=e,i=K(ae,o),b=te(o),v=le(i.baseId,r),p=de(i.baseId,r),l=r===i.value;return t.jsx(We,{asChild:!0,...b,focusable:!g,active:l,children:t.jsx(S.button,{type:"button",role:"tab","aria-selected":l,"aria-controls":p,"data-state":l?"active":"inactive","data-disabled":g?"":void 0,disabled:g,id:v,...f,ref:n,onMouseDown:y(e.onMouseDown,a=>{!g&&a.button===0&&a.ctrlKey===!1?i.onValueChange(r):a.preventDefault()}),onKeyDown:y(e.onKeyDown,a=>{[" ","Enter"].includes(a.key)&&i.onValueChange(r)}),onFocus:y(e.onFocus,()=>{const a=i.activationMode!=="manual";!l&&!g&&a&&i.onValueChange(r)})})})});re.displayName=ae;var ie="TabsContent",ce=d.forwardRef((e,n)=>{const{__scopeTabs:o,value:r,forceMount:g,children:f,...i}=e,b=K(ie,o),v=le(b.baseId,r),p=de(b.baseId,r),l=r===b.value,a=d.useRef(l);return d.useEffect(()=>{const s=requestAnimationFrame(()=>a.current=!1);return()=>cancelAnimationFrame(s)},[]),t.jsx(we,{present:g||l,children:({present:s})=>t.jsx(S.div,{"data-state":l?"active":"inactive","data-orientation":b.orientation,role:"tabpanel","aria-labelledby":v,hidden:!s,id:p,tabIndex:0,...i,ref:n,style:{...e.style,animationDuration:a.current?"0s":void 0},children:s&&f})})});ce.displayName=ie;function le(e,n){return`${e}-trigger-${n}`}function de(e,n){return`${e}-content-${n}`}var Ze=ne,ue=oe,fe=re,me=ce;const et=Ze,ge=d.forwardRef(({className:e,...n},o)=>t.jsx(ue,{ref:o,className:I("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...n}));ge.displayName=ue.displayName;const G=d.forwardRef(({className:e,...n},o)=>t.jsx(fe,{ref:o,className:I("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...n}));G.displayName=fe.displayName;const tt=d.forwardRef(({className:e,...n},o)=>t.jsx(me,{ref:o,className:I("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...n}));tt.displayName=me.displayName;function nt(){return Te({queryKey:["channels"],queryFn:()=>L.get("/api/channels"),staleTime:3e4})}function st(){const e=je();return Q({mutationFn:({name:n,data:o})=>L.put(`/api/channels/${encodeURIComponent(n)}`,o),onSuccess:()=>{e.invalidateQueries({queryKey:["channels"]}),F.success(u("channelSaved"))},onError:n=>F.error(n.message)})}function ot(){return Q({mutationFn:e=>L.post(`/api/channels/${encodeURIComponent(e)}/test`),onSuccess:e=>{e!=null&&e.reachable?F.success(u("channelTestOk",e.channel)):F.warning(u("channelTestFail",(e==null?void 0:e.status)??"unknown"))},onError:e=>F.error(e.message)})}function V(e,n){if(typeof n=="boolean")return"boolean";if(typeof n=="number")return"number";const o=e.toLowerCase();return o.includes("password")||o.includes("secret")||o.includes("token")||o.includes("aes_key")?"password":typeof n=="string"?"string":"json"}function at(e){return e.replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\b\w/g,n=>n.toUpperCase())}function rt({open:e,channelName:n,channelConfig:o,onClose:r}){const g=st(),[f,i]=d.useState({}),[b,v]=d.useState({});d.useEffect(()=>{if(o){i({...o});const s={};for(const[c,x]of Object.entries(o))V(c,x)==="json"&&(s[c]=JSON.stringify(x??null,null,2));v(s)}else i({}),v({})},[o,n]);const p=(s,c)=>{i(x=>({...x,[s]:c}))},l=s=>{if(s.preventDefault(),!n)return;const c={...f};for(const[x,h]of Object.entries(b))try{c[x]=h.trim()?JSON.parse(h):null}catch{F.error(u("invalidJson",x));return}g.mutate({name:n,data:c},{onSuccess:()=>r()})},a=Object.keys(f).sort((s,c)=>s==="enabled"?-1:c==="enabled"?1:s.localeCompare(c));return t.jsx(De,{open:e,onOpenChange:s=>!s&&r(),children:t.jsxs(Ae,{className:"sm:max-w-[560px] max-h-[85vh] overflow-hidden flex flex-col",children:[t.jsxs(_e,{children:[t.jsx(Pe,{className:"capitalize",children:u("editChannelTitle",n??"")}),t.jsx(ke,{children:u("channelFormDescription")})]}),t.jsxs("form",{onSubmit:l,className:"flex flex-col flex-1 overflow-hidden",children:[t.jsx(Ne,{className:"flex-1 max-h-[55vh] pr-3",children:t.jsxs("div",{className:"space-y-5 py-2",children:[a.map(s=>{const c=f[s],x=V(s,(o==null?void 0:o[s])??c);return t.jsxs("div",{className:"space-y-2",children:[t.jsx(Oe,{htmlFor:s,className:"text-sm font-medium",children:at(s)}),x==="boolean"&&t.jsxs("div",{className:"flex items-center justify-between rounded-lg border bg-muted/40 px-3 py-2.5",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:c?u("on"):u("off")}),t.jsx(Ge,{id:s,checked:c||!1,onCheckedChange:h=>p(s,h)})]}),x==="password"&&t.jsx(k,{id:s,type:"password",value:c??"",onChange:h=>p(s,h.target.value),placeholder:u("channelFieldPasswordHint"),autoComplete:"off"}),x==="string"&&t.jsx(k,{id:s,type:"text",value:c??"",onChange:h=>p(s,h.target.value)}),x==="number"&&t.jsx(k,{id:s,type:"number",value:c??0,onChange:h=>p(s,h.target.value===""?0:Number(h.target.value))}),x==="json"&&t.jsx("textarea",{id:s,value:b[s]??"",onChange:h=>v(m=>({...m,[s]:h.target.value})),className:"min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-xs font-mono ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]},s)}),a.length===0&&t.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:u("channelNoFields")})]})}),t.jsxs(Me,{className:"pt-4 flex-shrink-0",children:[t.jsx(E,{type:"button",variant:"outline",onClick:r,children:u("cancel")}),t.jsx(E,{type:"submit",disabled:g.isPending,children:g.isPending?u("saving"):u("save")})]})]})]})})}const it={telegram:"TG",discord:"DC",slack:"SK",whatsapp:"WA",feishu:"FS",dingtalk:"DT",qq:"QQ",wework:"WW",serverchan:"SC",googlechat:"GC",maixcam:"MX",teams:"TM",infoflow:"IF",email:"EM"},ct={telegram:"bg-sky-500",discord:"bg-indigo-500",slack:"bg-emerald-600",whatsapp:"bg-green-500",feishu:"bg-blue-500",dingtalk:"bg-blue-600",qq:"bg-cyan-500",wework:"bg-teal-600",serverchan:"bg-amber-500",googlechat:"bg-green-600",maixcam:"bg-orange-500",teams:"bg-violet-600",infoflow:"bg-rose-500",email:"bg-gray-500"};function vt(){const{data:e,isLoading:n}=nt(),o=ot(),[r,g]=d.useState("all"),[f,i]=d.useState(null),b=e?Object.entries(e).sort(([a],[s])=>a.localeCompare(s)):[],v=b.filter(([,a])=>a.enabled).length,p=r==="enabled"?b.filter(([,a])=>a.enabled):b,l=(a,s)=>{s.stopPropagation(),o.mutate(a)};return t.jsxs("div",{children:[t.jsx(Ie,{title:u("tabChannels"),description:u("channelsPageDescription")}),t.jsx(et,{value:r,onValueChange:g,className:"mb-6",children:t.jsxs(ge,{children:[t.jsxs(G,{value:"all",children:[u("channelsTabAll")," (",b.length,")"]}),t.jsxs(G,{value:"enabled",children:[u("channelsTabEnabled")," (",v,")"]})]})}),n&&t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:Array.from({length:8}).map((a,s)=>t.jsx(Ee,{className:"h-36 rounded-xl"},s))}),!n&&p.length>0&&t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:p.map(([a,s])=>{const c=s.enabled??!1,x=it[a]??a.slice(0,2).toUpperCase(),h=ct[a]??"bg-gray-400";return t.jsx(Fe,{className:I("cursor-pointer transition-[shadow,border-color] hover:shadow-md hover:border-primary/30",c&&"border-primary/20"),onClick:()=>i(a),children:t.jsxs(Se,{className:"p-5",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsx("div",{className:I("flex h-10 w-10 items-center justify-center rounded-lg text-white text-xs font-bold",h),children:x}),t.jsxs("span",{className:I("inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium",c?"bg-emerald-50 text-emerald-700 dark:bg-emerald-950 dark:text-emerald-300":"bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-400"),children:[t.jsx("span",{className:I("h-1.5 w-1.5 rounded-full",c?"bg-emerald-500":"bg-gray-400")}),c?u("on"):u("off")]})]}),t.jsx("h3",{className:"text-sm font-semibold capitalize mb-3 text-foreground",children:a}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:m=>{m.stopPropagation(),i(a)},children:u("edit")}),t.jsx(E,{size:"sm",variant:"ghost",className:"h-7 text-xs",disabled:!c||o.isPending,onClick:m=>l(a,m),children:o.isPending&&o.variables===a?u("testing"):u("test")})]})]})},a)})}),!n&&p.length===0&&t.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[t.jsx("div",{className:"h-14 w-14 flex items-center justify-center rounded-xl bg-muted mb-4",children:t.jsx("span",{className:"text-2xl text-muted-foreground",children:"#"})}),t.jsx("h3",{className:"text-sm font-semibold text-foreground mb-1.5",children:u("channelsEmptyTitle")}),t.jsx("p",{className:"text-sm text-muted-foreground max-w-sm",children:u("channelsEmptyDescription")})]}),t.jsx(rt,{open:f!==null,channelName:f,channelConfig:f&&e?e[f]??null:null,onClose:()=>i(null)})]})}export{vt as default};
