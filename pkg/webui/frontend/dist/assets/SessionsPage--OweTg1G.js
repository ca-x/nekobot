import{e as w,b as m,t as s,a as u,r as c,j as e,d as F}from"./index-DMfSApuS.js";import{u as L,H as K,B as N}from"./button-DVjcoFYi.js";import{C as b,a as S,b as C,c as M,d as D}from"./card-Bez7NN6a.js";import{I as Q}from"./input-BjWckbrv.js";import{S as _}from"./scroll-area-KV2hHBLE.js";import{u as T}from"./useMutation-TaRjHYf5.js";import{S as U}from"./save-hZIBG70c.js";import{T as P}from"./trash-2-CAs-alk1.js";const l={all:["sessions"],list:()=>[...l.all,"list"],detail:a=>[...l.all,"detail",a]};function $(){return L({queryKey:l.list(),queryFn:async()=>{const a=await u.get("/api/sessions");return Array.isArray(a)?a:[]},staleTime:1e4})}function H(a){return L({queryKey:l.detail(a??""),queryFn:()=>u.get(`/api/sessions/${encodeURIComponent(a)}`),enabled:!!a,staleTime:5e3})}function R(){const a=w();return T({mutationFn:({id:r,summary:n})=>u.put(`/api/sessions/${encodeURIComponent(r)}/summary`,{summary:n}),onSuccess:(r,n)=>{a.invalidateQueries({queryKey:l.list()}),a.invalidateQueries({queryKey:l.detail(n.id)}),m.success(s("sessionSummarySaved"))},onError:r=>m.error(r.message||s("sessionSummarySaveFailed"))})}function B(){const a=w();return T({mutationFn:r=>u.delete(`/api/sessions/${encodeURIComponent(r)}`),onSuccess:(r,n)=>{a.invalidateQueries({queryKey:l.list()}),a.invalidateQueries({queryKey:l.detail(n)}),m.success(s("sessionDeleted"))},onError:r=>m.error(r.message||s("sessionDeleteFailed"))})}function h(a){if(!a)return"-";const r=new Date(a);return Number.isNaN(r.getTime())?a:r.toLocaleString()}function Z(){const{data:a=[],isLoading:r}=$(),[n,x]=c.useState(""),[f,p]=c.useState(""),j=R(),g=B(),o=c.useMemo(()=>[...a].sort((t,d)=>new Date(d.updated_at).getTime()-new Date(t.updated_at).getTime()),[a]),y=o.some(t=>t.id===n);c.useEffect(()=>{n&&!y&&x("")},[n,y]);const{data:i,isLoading:q,isError:E}=H(n||null);c.useEffect(()=>{i&&p(i.summary||"")},[i]);const I=()=>{i&&j.mutate({id:i.id,summary:f})},k=()=>{if(!i||!window.confirm(s("sessionDeleteConfirm")))return;const t=i.id;g.mutate(t,{onSuccess:()=>{x(d=>d===t?"":d)}})};return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)]",children:[e.jsx(K,{title:s("tabSessions"),description:s("sessionsPageDescription")}),e.jsxs("div",{className:"flex flex-1 min-h-0 gap-4",children:[e.jsxs(b,{className:"w-80 min-h-0 flex flex-col",children:[e.jsxs(S,{className:"pb-3",children:[e.jsx(C,{className:"text-base",children:s("tabSessions")}),e.jsx(M,{children:s("sessionListCount",String(o.length))})]}),e.jsx(D,{className:"flex-1 min-h-0 p-0",children:e.jsx(_,{className:"h-full",children:e.jsxs("div",{className:"p-3 space-y-2",children:[r&&o.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-8",children:s("sessionsLoading")}),!r&&o.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-8",children:s("sessionsEmpty")}),o.map(t=>{var v;const d=((v=t.summary)==null?void 0:v.trim())||t.id,A=t.id===n;return e.jsxs("button",{type:"button",onClick:()=>x(t.id),className:F("w-full rounded-md border text-left p-3 transition-colors",A?"border-primary/40 bg-primary/5":"hover:bg-muted/40 border-border"),children:[e.jsx("div",{className:"text-xs text-muted-foreground truncate mb-1",children:t.id}),e.jsx("div",{className:"text-sm font-medium truncate mb-1",children:d}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s("sessionUpdatedAt",h(t.updated_at))}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s("sessionMessageCount",String(t.message_count))})]},t.id)})]})})})]}),e.jsxs(b,{className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(S,{className:"pb-3",children:e.jsx(C,{className:"text-base",children:s("sessionDetailsTitle")})}),e.jsxs(D,{className:"flex-1 min-h-0 pt-0",children:[!n&&e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground text-sm",children:s("sessionSelectHint")}),n&&q&&!i&&e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground text-sm",children:s("sessionDetailLoading")}),n&&E&&!i&&e.jsx("div",{className:"h-full flex items-center justify-center text-destructive text-sm",children:s("sessionDetailLoadFailed")}),i&&e.jsxs("div",{className:"h-full flex flex-col gap-4 min-h-0",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:s("sessionIdLabel")}),e.jsx("div",{className:"font-mono break-all",children:i.id})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:s("sessionMessageCountLabel")}),e.jsx("div",{children:i.message_count})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:s("sessionCreatedAtLabel")}),e.jsx("div",{children:h(i.created_at)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:s("sessionUpdatedAtLabel")}),e.jsx("div",{children:h(i.updated_at)})]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs text-muted-foreground mb-1 block",children:s("sessionSummaryLabel")}),e.jsx(Q,{value:f,onChange:t=>p(t.target.value),placeholder:s("sessionSummaryPlaceholder")})]}),e.jsxs(N,{onClick:I,disabled:j.isPending||f===i.summary,children:[e.jsx(U,{className:"h-4 w-4 mr-1.5"}),s("save")]}),e.jsxs(N,{variant:"destructive",onClick:k,disabled:g.isPending,children:[e.jsx(P,{className:"h-4 w-4 mr-1.5"}),s("delete")]})]}),e.jsxs("div",{className:"flex-1 min-h-0 rounded-md border",children:[e.jsx("div",{className:"px-3 py-2 border-b text-sm font-medium",children:s("sessionMessagesTitle")}),e.jsx(_,{className:"h-[calc(100%-2.5rem)]",children:e.jsxs("div",{className:"p-3 space-y-3",children:[i.messages.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-6",children:s("sessionNoMessages")}),i.messages.map((t,d)=>e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2 mb-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:t.role||"-"}),t.tool_call_id&&e.jsxs("span",{className:"text-xs text-muted-foreground font-mono",children:["tool_call_id: ",t.tool_call_id]})]}),e.jsx("pre",{className:"text-sm whitespace-pre-wrap break-words font-sans",children:t.content||""})]},`${t.tool_call_id||"msg"}-${d}`))]})})]})]})]})]})]})]})}export{Z as default};
