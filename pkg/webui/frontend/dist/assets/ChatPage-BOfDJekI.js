import{c as Y,r as n,g as G,j as e,t as o,d as O,a as q}from"./index-BGArHTig.js";import{H as X,B as E,S as Z,u as B}from"./scroll-area-DituK3c-.js";import{I as D}from"./Combination-BG_crsyY.js";import{C as L}from"./card-I9j3A_6K.js";import{S as V,a as _,b as A,c as z,d as C}from"./select-kF4nfyN6.js";import{R as ee}from"./refresh-cw-Bm9TJeLU.js";import{T as te}from"./trash-2-CWTeaqOC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=Y("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function ne(){const[s,r]=n.useState([]),[b,x]=n.useState("disconnected"),l=n.useRef(null),f=n.useRef(null),y=n.useCallback(()=>{if(f.current&&(clearTimeout(f.current),f.current=null),l.current){try{l.current.close()}catch{}l.current=null}},[]),c=n.useCallback(()=>{const a=G();if(!a){x("disconnected");return}y(),x("connecting");const p=`${window.location.protocol==="https:"?"wss":"ws"}://${window.location.host}/api/chat/ws?token=${encodeURIComponent(a)}`;let h;try{h=new WebSocket(p)}catch{x("disconnected");return}l.current=h,h.onopen=()=>{x("connected")},h.onclose=()=>{x("disconnected"),l.current=null},h.onerror=()=>{x("disconnected")},h.onmessage=k=>{let g;try{g=JSON.parse(k.data)}catch{return}const S=Date.now();g.type==="message"?r(j=>[...j,{role:"assistant",content:g.content||"",timestamp:S}]):g.type==="error"?r(j=>[...j,{role:"error",content:g.content||"Unknown error",timestamp:S}]):r(j=>[...j,{role:"system",content:g.content||g.type||"event",timestamp:S}])}},[y]),N=n.useCallback(()=>{c()},[c]),i=n.useCallback((a,m)=>{const p=l.current;!p||p.readyState!==WebSocket.OPEN||a.trim()&&(p.send(JSON.stringify({type:"message",content:a,model:m.model,provider:m.provider,fallback:m.fallbackProviders})),r(h=>[...h,{role:"user",content:a,timestamp:Date.now()}]))},[]),u=n.useCallback(()=>{const a=l.current;a&&a.readyState===WebSocket.OPEN&&a.send(JSON.stringify({type:"clear"})),r([])},[]);return n.useEffect(()=>(c(),y),[c,y]),{messages:s,sendMessage:i,clearMessages:u,connectionStatus:b,reconnect:N}}const M="__default__";function F(s){return s||M}function K(s){return s===M?"":s}function R(s){return new Date(s).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function re(){return B({queryKey:["providers"],queryFn:()=>q.get("/api/providers"),staleTime:3e4})}function le(){return B({queryKey:["config"],queryFn:()=>q.get("/api/config"),staleTime:3e4})}function ae(s,r){var N;const b=[],x=new Set,l=(N=r==null?void 0:r.agents)==null?void 0:N.defaults,f=(l==null?void 0:l.provider)||"",y=(l==null?void 0:l.fallback)||[],c=(i,u)=>{const a=u.trim();if(!a)return;const m=(i||"default").trim()||"default",p=`${m}::${a}`;x.has(p)||(x.add(p),b.push({provider:m,model:a}))};c(f,(l==null?void 0:l.model)||"");for(const i of s)if(i.default_model&&c(i.name,i.default_model),Array.isArray(i.models))for(const u of i.models)c(i.name,u);return{models:b,defaultProvider:f,defaultFallback:y}}function oe({message:s}){return s.role==="user"?e.jsx("div",{className:"flex justify-end mb-3",children:e.jsxs("div",{className:"max-w-[75%]",children:[e.jsx("div",{className:"rounded-2xl rounded-br-md bg-primary text-primary-foreground px-4 py-2.5 text-sm whitespace-pre-wrap break-words",children:s.content}),e.jsx("div",{className:"text-[10px] text-muted-foreground mt-1 text-right",children:R(s.timestamp)})]})}):s.role==="assistant"?e.jsx("div",{className:"flex justify-start mb-3",children:e.jsxs("div",{className:"max-w-[75%]",children:[e.jsx(L,{className:"px-4 py-2.5 text-sm whitespace-pre-wrap break-words",children:s.content}),e.jsx("div",{className:"text-[10px] text-muted-foreground mt-1",children:R(s.timestamp)})]})}):e.jsx("div",{className:"flex justify-center mb-3",children:e.jsxs("div",{className:O("max-w-[85%] rounded-lg px-3 py-1.5 text-xs text-center",s.role==="error"?"bg-destructive/10 text-destructive":"bg-muted text-muted-foreground"),children:[s.content,e.jsx("span",{className:"ml-2 opacity-60",children:R(s.timestamp)})]})})}function ce({status:s}){const r=O("h-2.5 w-2.5 rounded-full inline-block",s==="connected"&&"bg-green-500",s==="connecting"&&"bg-yellow-500 animate-pulse",s==="disconnected"&&"bg-red-500"),b=s==="connected"?o("wsConnected"):s==="connecting"?"Connecting...":o("wsDisconnected");return e.jsxs("span",{className:"inline-flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx("span",{className:r}),b]})}function he(){const{data:s=[]}=re(),{data:r}=le(),{messages:b,sendMessage:x,clearMessages:l,connectionStatus:f,reconnect:y}=ne(),{models:c,defaultProvider:N,defaultFallback:i}=ae(s,r),[u,a]=n.useState(""),[m,p]=n.useState(""),[h,k]=n.useState(""),[g,S]=n.useState(""),[j,T]=n.useState(""),I=n.useRef(null),$=n.useRef(!1);n.useEffect(()=>{var d,v;if($.current||!r)return;$.current=!0,N&&a(N),i.length>0&&S(i.join(", "));const t=((v=(d=r==null?void 0:r.agents)==null?void 0:d.defaults)==null?void 0:v.model)||"";t&&(p(t),k(t))},[r,N,i]),n.useEffect(()=>{var t;(t=I.current)==null||t.scrollIntoView({behavior:"smooth"})},[b]);const H=u?c.filter(t=>t.provider===u):c,J=n.useCallback(t=>{const d=K(t);a(d);const v=d?c.filter(w=>w.provider===d):c;if(m&&!v.some(w=>w.model===m)){const w=v.length>0?v[0].model:"";p(w),k(w)}},[c,m]),U=n.useCallback(t=>{const d=K(t);if(p(d),k(d),d){const v=c.find(w=>w.model===d);v&&v.provider!=="default"&&!u&&a(v.provider)}},[c,u]),P=n.useCallback(()=>{const t=j.trim();if(!t||f!=="connected")return;const d=h.trim()||m,v=u,w=g.split(",").map(Q=>Q.trim()).filter(Boolean);x(t,{provider:v,model:d,fallbackProviders:w}),T("")},[j,f,h,m,u,g,x]),W=n.useCallback(t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),P())},[P]);return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-4rem)]",children:[e.jsx(X,{title:o("tabChat")}),e.jsxs("div",{className:"flex flex-wrap items-end gap-3 mb-3",children:[e.jsxs("div",{className:"flex flex-col gap-1 min-w-[160px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:o("defaultProvider")}),e.jsxs(V,{value:F(u),onValueChange:J,children:[e.jsx(_,{className:"h-9 text-sm",children:e.jsx(A,{placeholder:o("defaultProvider")})}),e.jsxs(z,{children:[e.jsx(C,{value:M,children:o("defaultProvider")}),s.map(t=>e.jsx(C,{value:t.name,children:t.name},t.name))]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1 min-w-[200px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:o("defaultModel")}),e.jsxs(V,{value:F(m),onValueChange:U,children:[e.jsx(_,{className:"h-9 text-sm",children:e.jsx(A,{placeholder:o("defaultModel")})}),e.jsxs(z,{children:[e.jsx(C,{value:M,children:o("defaultModel")}),H.map(t=>e.jsx(C,{value:t.model,children:u?t.model:`${t.model} (${t.provider})`},`${t.provider}::${t.model}`))]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1 min-w-[180px]",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:o("customModel")}),e.jsx(D,{className:"h-9 text-sm",placeholder:o("customModel"),value:h,onChange:t=>k(t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-1 min-w-[200px] flex-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:o("fallbackProviders")}),e.jsx(D,{className:"h-9 text-sm",placeholder:o("fallbackProviders"),value:g,onChange:t=>S(t.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2 pb-0.5",children:[e.jsx(ce,{status:f}),f==="disconnected"&&e.jsxs(E,{variant:"outline",size:"sm",className:"h-9 gap-1.5",onClick:y,children:[e.jsx(ee,{className:"h-3.5 w-3.5"}),o("reconnect")]}),e.jsxs(E,{variant:"outline",size:"sm",className:"h-9 gap-1.5",onClick:l,children:[e.jsx(te,{className:"h-3.5 w-3.5"}),o("clearSession")]})]})]}),e.jsxs(L,{className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:[e.jsx(Z,{className:"flex-1 p-4",children:b.length===0?e.jsx("div",{className:"flex items-center justify-center h-full min-h-[200px] text-sm text-muted-foreground",children:o("chatEmptyHint")}):e.jsxs("div",{className:"flex flex-col",children:[b.map((t,d)=>e.jsx(oe,{message:t},d)),e.jsx("div",{ref:I})]})}),e.jsxs("div",{className:"border-t p-3 flex gap-2 items-end",children:[e.jsx("textarea",{className:"flex-1 resize-none rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 min-h-[40px] max-h-[160px]",rows:1,placeholder:o("chatPlaceholder"),value:j,onChange:t=>T(t.target.value),onKeyDown:W,disabled:f!=="connected"}),e.jsx(E,{size:"icon",className:"h-10 w-10 shrink-0",onClick:P,disabled:f!=="connected"||!j.trim(),children:e.jsx(se,{className:"h-4 w-4"})})]})]})]})}export{he as default};
