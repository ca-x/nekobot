<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nekobot</title>
  <link rel="stylesheet" href="vendor/xterm/xterm.css">
  <link rel="stylesheet" href="vendor/remixicon/remixicon.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app">
    <header class="topbar">
      <span class="brand">Nekobot</span>
      <span class="brand-sub" data-i18n="appSubtitle">Control Panel</span>
      <div class="spacer"></div>
      <div class="topbar-controls">
        <button id="themeToggle" class="icon-btn" aria-label="Toggle theme">
          <svg id="themeIconSun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><circle cx="12" cy="12" r="4"/><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
          <svg id="themeIconMoon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
        </button>
        <select id="langSelect" class="lang-select">
          <option value="en">EN</option>
          <option value="zh-CN">中文</option>
          <option value="ja">日本語</option>
        </select>
      </div>
    </header>

    <!-- Auth -->
    <div id="authWrapper" class="auth-wrapper">
      <div id="authCard" class="card auth-card">
        <svg class="auth-neko" width="56" height="56" viewBox="0 0 64 64" fill="none">
          <path d="M14 28L19 10l9 12h8l9-12 5 18" fill="currentColor" opacity="0.13" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          <circle cx="32" cy="38" r="19" fill="var(--panel)" stroke="currentColor" stroke-width="2"/>
          <circle cx="24" cy="36" r="2.8" fill="currentColor"/><circle cx="40" cy="36" r="2.8" fill="currentColor"/>
          <circle cx="25.2" cy="35" r="0.9" fill="var(--panel)"/><circle cx="41.2" cy="35" r="0.9" fill="var(--panel)"/>
          <ellipse cx="32" cy="41" rx="2" ry="1.4" fill="currentColor" opacity="0.5"/>
          <path d="M28 44c2 2 4 2.5 4 2.5s2-.5 4-2.5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        </svg>
        <h1>Nekobot</h1>
        <p id="authHint" class="auth-hint" data-i18n="checkingInit">Checking initialization status...</p>

        <div id="authInit" class="hidden">
          <h3 data-i18n="initTitle">Initialize Admin Account</h3>
          <div class="auth-form">
            <input id="initUsername" value="admin" data-i18n-ph="username" placeholder="Username">
            <input id="initPassword" type="password" data-i18n-ph="password" placeholder="Password">
            <button id="initBtn" class="btn btn-primary" style="width:100%;" data-i18n="initialize">Initialize</button>
          </div>
        </div>

        <div id="authLogin" class="hidden">
          <h3 data-i18n="loginTitle">Login</h3>
          <div class="auth-form">
            <input id="loginUsername" value="admin" data-i18n-ph="username" placeholder="Username">
            <input id="loginPassword" type="password" data-i18n-ph="password" placeholder="Password">
            <button id="loginBtn" class="btn btn-primary" style="width:100%;" data-i18n="login">Login</button>
          </div>
        </div>

        <p id="authError" class="error-text"></p>
      </div>
    </div>

    <!-- Dashboard -->
    <div id="mainCard" class="card main-card hidden">
      <div class="dash-header">
        <h2 data-i18n="dashboard">Dashboard</h2>
        <div class="spacer"></div>
        <span id="wsState" class="ws-status"><span class="ws-dot"></span><span data-i18n="wsDisconnected">Disconnected</span></span>
        <button id="logoutBtn" class="btn btn-danger btn-sm" data-i18n="logout">Logout</button>
      </div>

      <nav class="tabs">
        <button class="tab active" data-tab="chat" data-i18n="tabChat">Chat</button>
        <button class="tab" data-tab="tools" data-i18n="tabTools">Tools</button>
        <button class="tab" data-tab="providers" data-i18n="tabProviders">Providers</button>
        <button class="tab" data-tab="channels" data-i18n="tabChannels">Channels</button>
        <button class="tab" data-tab="config" data-i18n="tabConfig">Config</button>
        <button class="tab" data-tab="status" data-i18n="tabStatus">System</button>
      </nav>

      <!-- Chat Tab -->
      <section id="tab-chat">
        <div class="chat-controls">
          <select id="chatProviderSelect"></select>
          <select id="modelSelect"></select>
          <input id="modelInput" data-i18n-ph="customModel" placeholder="Custom model override">
          <input id="fallbackInput" data-i18n-ph="fallbackProviders" placeholder="Fallback providers (comma-separated)">
          <button id="connectWsBtn" class="btn btn-sm" data-i18n="reconnect">Reconnect</button>
          <button id="clearChatBtn" class="btn btn-sm" data-i18n="clearSession">Clear</button>
        </div>
        <div id="chatLog" class="chat-log">
          <div class="chat-empty" data-i18n="chatEmptyHint">Send a message to start chatting</div>
        </div>
        <div class="chat-input-row">
          <textarea id="chatInput" rows="2" data-i18n-ph="chatPlaceholder" placeholder="Type a message..."></textarea>
          <button id="sendBtn" class="btn btn-primary" data-i18n="send">Send</button>
        </div>
      </section>

      <!-- Tools Tab -->
      <section id="tab-tools" class="hidden">
        <div id="toolsLayout" class="tools-layout">
          <aside class="tools-sidebar">
            <div class="toolbar">
              <button id="newToolSessionBtn" class="btn btn-sm btn-primary" data-i18n="newToolSession">New Session</button>
              <button id="refreshToolSessionsBtn" class="btn btn-sm" data-i18n="refresh">Refresh</button>
              <button id="cleanupToolSessionsBtn" class="btn btn-sm" data-i18n="cleanupTerminated">Cleanup Stopped</button>
            </div>
            <div id="toolSessionsList" class="tool-session-list"></div>
          </aside>
          <div class="tools-main">
            <div class="tools-main-head">
              <div id="toolTabs" class="tool-tabs"></div>
              <button id="clearSplitBtn" class="btn btn-sm" data-i18n="clearSplit">Clear Split</button>
            </div>
            <div class="tools-split">
              <div id="toolPanelPrimary" class="tool-panel">
                <div class="tool-panel-head">
                  <span id="toolPrimaryTitle" class="tool-panel-title">-</span>
                  <div class="tool-panel-head-actions">
                    <span id="toolPrimaryStatus" class="msg-text">-</span>
                    <button id="toolPrimaryMaxBtn" class="btn btn-sm" data-i18n="maximize">Maximize</button>
                  </div>
                </div>
                <div id="toolOutputPrimary" class="tool-output"></div>
                <div class="tool-input-row">
                  <textarea id="toolInputPrimary" rows="2" data-i18n-ph="toolInputPlaceholder" placeholder="Type command..."></textarea>
                  <button id="toolSendPrimaryBtn" class="btn btn-sm btn-primary" data-i18n="send">Send</button>
                </div>
              </div>
              <div id="toolPanelSplit" class="tool-panel hidden">
                <div class="tool-panel-head">
                  <span id="toolSplitTitle" class="tool-panel-title">-</span>
                  <div class="tool-panel-head-actions">
                    <span id="toolSplitStatus" class="msg-text">-</span>
                    <button id="toolSplitMaxBtn" class="btn btn-sm" data-i18n="maximize">Maximize</button>
                  </div>
                </div>
                <div id="toolOutputSplit" class="tool-output"></div>
                <div class="tool-input-row">
                  <textarea id="toolInputSplit" rows="2" data-i18n-ph="toolInputPlaceholder" placeholder="Type command..."></textarea>
                  <button id="toolSendSplitBtn" class="btn btn-sm btn-primary" data-i18n="send">Send</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Providers Tab -->
      <section id="tab-providers" class="hidden">
        <div class="toolbar">
          <select id="providerSelect"></select>
          <button id="refreshProvidersBtn" class="btn btn-sm" data-i18n="refresh">Refresh</button>
          <button id="newProviderBtn" class="btn btn-sm" data-i18n="newProvider">New</button>
          <button id="editProviderBtn" class="btn btn-sm" data-i18n="editProvider">Edit</button>
          <button id="fetchProviderModelsBtn" class="btn btn-sm" data-i18n="fetchModels">Discover Models</button>
          <button id="saveProviderBtn" class="btn btn-sm btn-primary" data-i18n="save">Save</button>
          <button id="deleteProviderBtn" class="btn btn-sm btn-danger" data-i18n="delete">Delete</button>
          <span id="providerMsg" class="msg-text"></span>
        </div>
        <div class="toolbar mt-sm">
          <div id="providerModelPicker" class="provider-model-picker hidden">
            <div class="provider-model-picker-head">
              <input id="providerModelFilter" data-i18n-ph="filterModels" placeholder="Filter models">
              <span id="providerModelCounter" class="msg-text"></span>
            </div>
            <select id="providerModelSelect" multiple size="8"></select>
            <div class="toolbar mt-sm">
              <button id="selectAllProviderModelsBtn" class="btn btn-sm" data-i18n="selectAllModels">Select all</button>
              <button id="clearProviderModelsBtn" class="btn btn-sm" data-i18n="clearModelSelection">Clear</button>
              <button id="applyProviderModelsBtn" class="btn btn-sm btn-primary" data-i18n="applyModelSelection">Apply</button>
            </div>
          </div>
          <div id="providerManualModelRow" class="toolbar">
            <input id="providerModelInput" data-i18n-ph="manualModel" placeholder="Manual model name" style="max-width:260px;">
            <button id="addProviderModelBtn" class="btn btn-sm" data-i18n="addModel">Add</button>
          </div>
        </div>
        <textarea id="providerEditor" rows="14" class="editor-area" spellcheck="false"></textarea>
      </section>

      <!-- Channels Tab -->
      <section id="tab-channels" class="hidden">
        <div class="toolbar">
          <button id="refreshChannelsBtn" class="btn btn-sm" data-i18n="refresh">Refresh</button>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th data-i18n="channel">Channel</th>
              <th data-i18n="enabled">Enabled</th>
              <th data-i18n="status">Status</th>
              <th data-i18n="action">Action</th>
            </tr>
          </thead>
          <tbody id="channelsBody"></tbody>
        </table>
        <div id="channelEditor" class="section-editor hidden">
          <h3 id="channelEditorTitle">Edit Channel</h3>
          <textarea id="channelEditorInput" rows="12" class="editor-area" spellcheck="false"></textarea>
          <div class="toolbar mt">
            <button id="saveChannelBtn" class="btn btn-sm btn-primary" data-i18n="save">Save</button>
            <button id="cancelChannelBtn" class="btn btn-sm" data-i18n="cancel">Cancel</button>
            <span id="channelEditorMsg" class="msg-text"></span>
          </div>
        </div>
      </section>

      <!-- Config Tab -->
      <section id="tab-config" class="hidden">
        <div class="toolbar">
          <select id="configSectionSelect"></select>
          <button id="refreshConfigBtn" class="btn btn-sm" data-i18n="refresh">Refresh</button>
          <button id="resetConfigBtn" class="btn btn-sm" data-i18n="reset">Reset</button>
          <button id="saveConfigBtn" class="btn btn-sm btn-primary" data-i18n="save">Save</button>
          <span id="configMsg" class="msg-text"></span>
        </div>
        <div id="configSectionHint" class="msg-text mt-sm"></div>
        <textarea id="configEditor" rows="16" class="editor-area" spellcheck="false"></textarea>
      </section>

      <!-- Status Tab -->
      <section id="tab-status" class="hidden">
        <div class="toolbar">
          <button id="refreshStatusBtn" class="btn btn-sm" data-i18n="refresh">Refresh</button>
        </div>
        <pre id="statusPre" class="json-pre">{}</pre>
      </section>
    </div>

    <div id="providerDialog" class="dialog-overlay hidden">
      <div class="dialog-card">
        <h3 id="providerDialogTitle">Provider</h3>
        <div class="dialog-grid">
          <label class="dialog-field">
            <span data-i18n="providerType">Provider type</span>
            <select id="providerDialogKind">
              <option value="openai">openai</option>
              <option value="anthropic">anthropic</option>
              <option value="gemini">gemini</option>
              <option value="ollama">ollama</option>
              <option value="groq">groq</option>
              <option value="lmstudio">lmstudio</option>
              <option value="vllm">vllm</option>
              <option value="generic">generic</option>
            </select>
          </label>
          <label class="dialog-field">
            <span data-i18n="providerName">Provider name</span>
            <input id="providerDialogName" data-i18n-ph="providerName" placeholder="Provider name">
          </label>
          <label class="dialog-field">
            <span data-i18n="apiEndpoint">API endpoint</span>
            <input id="providerDialogApiBase" data-i18n-ph="apiEndpoint" placeholder="API endpoint">
          </label>
          <label class="dialog-field">
            <span data-i18n="proxyAddress">Proxy</span>
            <input id="providerDialogProxy" data-i18n-ph="proxyAddress" placeholder="Proxy URL (optional)">
          </label>
          <label class="dialog-field">
            <span data-i18n="apiKey">API key</span>
            <input id="providerDialogApiKey" type="password" data-i18n-ph="apiKey" placeholder="API key">
          </label>
        </div>
        <div class="toolbar mt">
          <button id="providerDialogCancelBtn" class="btn btn-sm" data-i18n="cancel">Cancel</button>
          <button id="providerDialogApplyBtn" class="btn btn-sm btn-primary" data-i18n="apply">Apply</button>
        </div>
      </div>
    </div>

    <div id="toolSessionDialog" class="dialog-overlay hidden">
      <div class="dialog-card">
        <h3 id="toolSessionDialogTitle" data-i18n="newToolSessionTitle">New Tool Session</h3>
        <div class="dialog-grid">
          <label class="dialog-field">
            <span data-i18n="toolName">Tool</span>
            <select id="toolSessionTool">
              <option value="codex">codex</option>
              <option value="opencode">opencode</option>
              <option value="claude">claude</option>
              <option value="aider">aider</option>
              <option value="__custom__" data-i18n="customTool">custom</option>
            </select>
          </label>
          <label id="toolSessionCustomToolField" class="dialog-field hidden">
            <span data-i18n="customTool">Custom tool</span>
            <input id="toolSessionToolCustom" data-i18n-ph="customTool" placeholder="custom tool">
          </label>
          <label class="dialog-field">
            <span data-i18n="sessionTitle">Title</span>
            <input id="toolSessionTitle" data-i18n-ph="sessionTitle" placeholder="Session title">
          </label>
          <label class="dialog-field">
            <span data-i18n="launchCommand">Command</span>
            <input id="toolSessionCommand" data-i18n-ph="launchCommand" placeholder="Command (optional)">
            <small class="field-help" data-i18n="launchCommandHelp">Leave empty to run the selected tool directly.</small>
          </label>
          <label class="dialog-field">
            <span data-i18n="workingDirectory">Working directory</span>
            <input id="toolSessionWorkdir" data-i18n-ph="workingDirectory" placeholder="Working directory">
          </label>
          <label class="dialog-field">
            <span data-i18n="proxyMode">Proxy mode</span>
            <select id="toolSessionProxyMode">
              <option value="inherit" data-i18n="proxyModeInherit">inherit</option>
              <option value="clear" data-i18n="proxyModeClear">clear</option>
              <option value="custom" data-i18n="proxyModeCustom">custom</option>
            </select>
          </label>
          <label id="toolSessionProxyUrlField" class="dialog-field hidden">
            <span data-i18n="proxyAddress">Proxy</span>
            <input id="toolSessionProxyUrl" data-i18n-ph="proxyAddress" placeholder="Proxy URL (optional)">
          </label>
          <label class="dialog-field">
            <span data-i18n="accessMode">Access mode</span>
            <select id="toolSessionAccessMode">
              <option value="none">none</option>
              <option value="one_time">one_time</option>
              <option value="permanent">permanent</option>
            </select>
          </label>
          <label class="dialog-field">
            <span data-i18n="accessPassword">Access password</span>
            <input id="toolSessionAccessPassword" data-i18n-ph="accessPassword" placeholder="Leave empty to auto-generate">
          </label>
          <label class="dialog-field">
            <span data-i18n="publicBaseUrl">Public base URL</span>
            <input id="toolSessionPublicBaseUrl" data-i18n-ph="publicBaseUrl" placeholder="https://your-domain-or-ip">
          </label>
        </div>
        <div class="toolbar mt">
          <button id="toolSessionDialogCancelBtn" class="btn btn-sm" data-i18n="cancel">Cancel</button>
          <button id="toolSessionDialogCreateBtn" class="btn btn-sm btn-primary" data-i18n="createSession">Create</button>
        </div>
      </div>
    </div>

    <div id="toolAccessDialog" class="dialog-overlay hidden">
      <div class="dialog-card">
        <h3 data-i18n="toolAccessDialogTitle">Session Access Info</h3>
        <div id="toolAccessSessionHint" class="msg-text"></div>
        <div class="dialog-grid">
          <label class="dialog-field">
            <span data-i18n="accessUrl">Access URL</span>
            <div class="field-inline">
              <input id="toolAccessUrlInput" readonly>
              <div class="field-actions">
                <button id="toolAccessCopyUrlBtn" class="icon-btn input-icon-btn" title="Copy URL" aria-label="Copy URL"><i class="ri-file-copy-line" aria-hidden="true"></i></button>
              </div>
            </div>
          </label>
          <label class="dialog-field">
            <span data-i18n="permanentPassword">Permanent password</span>
            <div class="field-inline">
              <input id="toolAccessPasswordInput" readonly>
              <div class="field-actions">
                <button id="toolAccessRefreshBtn" class="icon-btn input-icon-btn" title="Refresh Access" aria-label="Refresh Access"><i class="ri-refresh-line" aria-hidden="true"></i></button>
                <button id="toolAccessCopyPasswordBtn" class="icon-btn input-icon-btn" title="Copy Password" aria-label="Copy Password"><i class="ri-file-copy-line" aria-hidden="true"></i></button>
              </div>
            </div>
          </label>
          <label class="dialog-field">
            <span data-i18n="otpPassword">One-time password</span>
            <div class="otp-row">
              <div class="field-inline">
                <input id="toolAccessOtpInput" readonly>
                <div class="field-actions">
                  <button id="toolAccessOtpRefreshBtn" class="icon-btn input-icon-btn" title="Refresh OTP" aria-label="Refresh OTP"><i class="ri-refresh-line" aria-hidden="true"></i></button>
                  <button id="toolAccessCopyOtpBtn" class="icon-btn input-icon-btn" title="Copy OTP" aria-label="Copy OTP"><i class="ri-file-copy-line" aria-hidden="true"></i></button>
                </div>
              </div>
              <div class="otp-timer-wrap">
                <div id="toolAccessOtpRing" class="otp-ring" style="--otp-progress: 0deg;">
                  <span id="toolAccessOtpCountdown">-</span>
                </div>
              </div>
            </div>
          </label>
        </div>
        <div class="toolbar mt">
          <div class="spacer"></div>
          <button id="toolAccessDialogCloseBtn" class="btn btn-sm btn-primary" data-i18n="close">Close</button>
        </div>
      </div>
    </div>

    <div class="footer">Powered by Nekobot <span id="versionBadge" class="version-badge hidden">v0.0.0</span></div>
  </div>
  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script src="vendor/xterm/xterm.js"></script>
  <script src="vendor/xterm/addon-fit.js"></script>
  <script src="vendor/xterm/addon-web-links.js"></script>
  <script src="vendor/xterm/addon-unicode11.js"></script>
  <script src="app.js"></script>
</body>
</html>
