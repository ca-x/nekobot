{
  "_comment": "=== NekoBot 配置文件 ===",
  "_description": {
    "配置加载优先级": [
      "1. 命令行参数 (最高优先级)",
      "2. 环境变量 (NEKOBOT_ 前缀)",
      "3. ~/.nekobot/config.json (用户配置)",
      "4. /etc/nekobot/config.json (系统配置)",
      "5. 代码默认值 (最低优先级)"
    ],
    "自动故障转移": "配置 fallback 数组后，主 provider 失败时自动尝试备用 provider",
    "断路器保护": "连续 5 次失败后自动切换到下一个 provider，5 分钟后重试"
  },

  "agents": {
    "defaults": {
      "workspace": "~/.nekobot/workspace",
      "restrict_to_workspace": true,
      "provider": "anthropic",
      "fallback": ["openai", "ollama"],
      "model": "claude-3-5-sonnet-20241022",
      "max_tokens": 4096,
      "temperature": 0.7,
      "max_tool_iterations": 10,
      "skills_dir": "~/.nekobot/skills",
      "skills_auto_reload": true,
      "_notes": {
        "fallback": "可选，指定备用 provider 列表实现自动故障转移",
        "restrict_to_workspace": "限制文件操作在 workspace 内",
        "skills_dir": "自定义技能目录，会自动加载 Markdown 格式的技能定义",
        "skills_auto_reload": "文件修改时自动重载技能"
      }
    }
  },

  "providers": {
    "_comment": "所有 provider 只需配置 api_key 和 api_base",

    "anthropic": {
      "api_key": "",
      "api_base": "https://api.anthropic.com",
      "_models": ["claude-3-5-sonnet-20241022", "claude-3-opus-20240229", "claude-3-haiku-20240307"]
    },
    "openai": {
      "api_key": "",
      "api_base": "https://api.openai.com/v1",
      "_models": ["gpt-4-turbo", "gpt-4", "gpt-3.5-turbo"]
    },
    "gemini": {
      "api_key": "",
      "api_base": "https://generativelanguage.googleapis.com",
      "_models": ["gemini-pro", "gemini-pro-vision"]
    },
    "openrouter": {
      "api_key": "",
      "api_base": "https://openrouter.ai/api/v1",
      "_description": "OpenRouter - 通过统一 API 访问多个模型",
      "_models": ["anthropic/claude-3.5-sonnet", "openai/gpt-4-turbo", "google/gemini-pro"]
    },
    "deepseek": {
      "api_key": "",
      "api_base": "https://api.deepseek.com/v1",
      "_description": "DeepSeek - 高性价比国产大模型",
      "_models": ["deepseek-chat", "deepseek-coder"]
    },
    "groq": {
      "api_key": "",
      "api_base": "https://api.groq.com/openai/v1",
      "_description": "Groq - 超快 LLM 推理",
      "_models": ["llama-3.1-70b-versatile", "mixtral-8x7b-32768"]
    },
    "zhipu": {
      "api_key": "",
      "api_base": "https://open.bigmodel.cn/api/paas/v4",
      "_description": "智谱 AI - GLM 系列模型",
      "_models": ["glm-4", "glm-4v", "glm-3-turbo"]
    },
    "moonshot": {
      "api_key": "",
      "api_base": "https://api.moonshot.cn/v1",
      "_description": "月之暗面 - Kimi 模型",
      "_models": ["moonshot-v1-8k", "moonshot-v1-32k", "moonshot-v1-128k"]
    },
    "nvidia": {
      "api_key": "",
      "api_base": "https://integrate.api.nvidia.com/v1",
      "_description": "NVIDIA API Catalog",
      "_models": ["nvidia/llama-3.1-nemotron-70b-instruct"]
    },
    "ollama": {
      "api_key": "ollama",
      "api_base": "http://localhost:11434/v1",
      "_description": "Ollama - 本地部署模型 (需先安装 Ollama)",
      "_models": ["llama3:70b", "llama3:8b", "mistral", "codellama", "qwen2"],
      "_install": "curl -fsSL https://ollama.com/install.sh | sh"
    },
    "vllm": {
      "api_key": "vllm",
      "api_base": "http://localhost:8000/v1",
      "_description": "vLLM - 高性能自建推理服务",
      "_note": "需自行部署: python -m vllm.entrypoints.openai.api_server --model <model-name>"
    }
  },

  "gateway": {
    "host": "0.0.0.0",
    "port": 8080,
    "_note": "Gateway 模式: nekobot gateway"
  },

  "channels": {
    "_comment": "多渠道接入配置 - 在 gateway 模式下使用",

    "telegram": {
      "enabled": false,
      "bot_token": "",
      "allow_from": [],
      "proxy": "",
      "_note": "从 @BotFather 获取 bot_token"
    },
    "discord": {
      "enabled": false,
      "bot_token": "",
      "allow_from": [],
      "_note": "从 Discord Developer Portal 创建 bot"
    },
    "slack": {
      "enabled": false,
      "bot_token": "",
      "app_token": "",
      "allow_from": [],
      "_note": "需要 Bot Token 和 App Token (Socket Mode)"
    },
    "whatsapp": {
      "enabled": false,
      "bridge_url": "ws://localhost:3000",
      "allow_from": [],
      "_note": "需要部署 WhatsApp Bridge 服务"
    },
    "feishu": {
      "enabled": false,
      "app_id": "",
      "app_secret": "",
      "encrypt_key": "",
      "verification_token": "",
      "allow_from": [],
      "_note": "飞书开放平台创建应用"
    },
    "dingtalk": {
      "enabled": false,
      "client_id": "",
      "client_secret": "",
      "allow_from": [],
      "_note": "钉钉开放平台创建应用"
    },
    "qq": {
      "enabled": false,
      "app_id": "",
      "app_secret": "",
      "allow_from": [],
      "_note": "QQ 机器人开放平台"
    },
    "maixcam": {
      "enabled": false,
      "host": "0.0.0.0",
      "port": 8765,
      "allow_from": [],
      "_note": "MaixCAM 设备接入"
    },
    "serverchan": {
      "enabled": false,
      "bot_token": "",
      "allow_from": [],
      "_note": "Server酱推送服务"
    },
    "wework": {
      "enabled": false,
      "corp_id": "",
      "agent_id": "",
      "corp_secret": "",
      "token": "",
      "encoding_aes_key": "",
      "allow_from": [],
      "_note": "企业微信应用"
    },
    "googlechat": {
      "enabled": false,
      "project_id": "",
      "credentials_file": "",
      "allow_from": [],
      "_note": "Google Chat Bot (需要 Service Account)"
    }
  },

  "tools": {
    "_comment": "Agent 可用的工具配置",
    "web": {
      "search": {
        "api_key": "",
        "max_results": 5,
        "_note": "Brave Search API: https://brave.com/search/api/"
      },
      "fetch": {
        "max_chars": 50000,
        "_note": "抓取网页内容的最大字符数"
      }
    }
  },

  "heartbeat": {
    "enabled": false,
    "interval_minutes": 60,
    "_note": "自主任务执行 - 从 workspace/HEARTBEAT.md 读取提示词定期执行"
  },

  "state": {
    "backend": "file",
    "file_path": "",
    "redis_addr": "localhost:6379",
    "redis_password": "",
    "redis_db": 0,
    "redis_prefix": "nekobot:",
    "_notes": {
      "backend": "可选: file 或 redis",
      "file_path": "留空则使用 workspace/state.json"
    }
  },

  "bus": {
    "type": "local",
    "redis_addr": "localhost:6379",
    "redis_password": "",
    "redis_db": 0,
    "redis_prefix": "nekobot:bus:",
    "_notes": {
      "type": "可选: local 或 redis",
      "local": "进程内消息总线，适合单机部署",
      "redis": "Redis 消息总线，适合分布式部署"
    }
  },

  "memory": {
    "_comment": "长期记忆系统 (可选)",
    "qmd": {
      "enabled": false,
      "command": "qmd",
      "include_default": true,
      "paths": [
        {
          "name": "docs",
          "path": "~/Documents",
          "pattern": "**/*.md"
        }
      ],
      "sessions": {
        "enabled": true,
        "export_dir": "${WORKSPACE}/memory/sessions",
        "retention_days": 90
      },
      "update": {
        "on_boot": true,
        "interval": "30m",
        "command_timeout": "30s",
        "update_timeout": "5m"
      },
      "_note": "需要安装 qmd: https://github.com/polyverse-app/qmd"
    }
  },

  "_examples": {
    "_comment": "=== 常见配置示例 ===",

    "示例1_最简配置": {
      "_description": "只配置一个 provider，不使用任何高级功能",
      "agents": {
        "defaults": {
          "provider": "anthropic",
          "model": "claude-3-5-sonnet-20241022"
        }
      },
      "providers": {
        "anthropic": {
          "api_key": "your-api-key",
          "api_base": "https://api.anthropic.com"
        }
      }
    },

    "示例2_云端主力+本地备份": {
      "_description": "主用 Anthropic，失败时自动切换到 OpenAI，最后使用本地 Ollama",
      "agents": {
        "defaults": {
          "provider": "anthropic",
          "fallback": ["openai", "ollama"],
          "model": "claude-3-5-sonnet-20241022"
        }
      }
    },

    "示例3_本地优先节省成本": {
      "_description": "优先使用本地模型，失败时再使用云端 API",
      "agents": {
        "defaults": {
          "provider": "ollama",
          "fallback": ["openai"],
          "model": "llama3:70b"
        }
      }
    },

    "示例4_国产大模型": {
      "_description": "使用国产大模型提供商",
      "agents": {
        "defaults": {
          "provider": "deepseek",
          "fallback": ["zhipu", "moonshot"],
          "model": "deepseek-chat"
        }
      },
      "providers": {
        "deepseek": {
          "api_key": "your-deepseek-key",
          "api_base": "https://api.deepseek.com/v1"
        },
        "zhipu": {
          "api_key": "your-zhipu-key",
          "api_base": "https://open.bigmodel.cn/api/paas/v4"
        },
        "moonshot": {
          "api_key": "your-moonshot-key",
          "api_base": "https://api.moonshot.cn/v1"
        }
      }
    },

    "示例5_环境变量配置": {
      "_description": "通过环境变量配置，适合 Docker/CI 环境",
      "_bash": [
        "export NEKOBOT_AGENTS_DEFAULTS_PROVIDER=anthropic",
        "export NEKOBOT_AGENTS_DEFAULTS_MODEL=claude-3-5-sonnet-20241022",
        "export NEKOBOT_PROVIDERS_ANTHROPIC_API_KEY=your-key",
        "export NEKOBOT_PROVIDERS_ANTHROPIC_API_BASE=https://api.anthropic.com",
        "nekobot agent"
      ]
    },

    "示例6_Gateway多渠道": {
      "_description": "启用 Gateway 模式，接入多个聊天平台",
      "gateway": {
        "host": "0.0.0.0",
        "port": 8080
      },
      "channels": {
        "telegram": {
          "enabled": true,
          "bot_token": "your-telegram-token",
          "allow_from": ["user_id_1", "user_id_2"]
        },
        "discord": {
          "enabled": true,
          "bot_token": "your-discord-token",
          "allow_from": ["user_id_1"]
        }
      }
    }
  }
}
